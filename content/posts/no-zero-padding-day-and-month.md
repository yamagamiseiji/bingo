+++
title = "Gnuplotで月の数字をゼロ埋めしない方法"
author = ["YAMAGAMI"]
date = 2022-09-03T00:00:00+09:00
tags = ["gnuplot", "ledger"]
categories = ["comp"]
draft = false
+++

##  {#}

描きたかったのは図[1](#org48bc229)のように
X軸の「月」をゼロ埋めしない数字にしたチャート[^fn:1]。

<a id="org48bc229"></a>

{{< figure src="https://dl.dropboxusercontent.com/s/fdjzi6fnxlc17e5/single-digit-month-sample.svg%22" caption="&#22259;1:  X軸の目盛り=月の数値がゼロ埋めされていない" width="90%" >}}

Bashでは `%-m` と書けばゼロ埋めされない月になります。なのでGnuplotでも簡単にできると思ったのですが、ちょっと甘かったです。

Gnuplotのマニュアルを見ると、「月」には次のようなフォーマットがあります。

| フォーマット | 説明        | 例                  |
|--------|-----------|--------------------|
| %b or %h | 月の省略名  | Jan, Feb...         |
| %B       | 月のフルネーム | January, February.. |
| %m       | 月のゼロ埋めされた数字 | 01,02...            |

けれどもゼロ埋めしないためのフォーマットを見つけることはできませんでした。当然のことながら `%-m` にしてもBashのようにはなりません :sweat:

多くのユーザには「当たり前」で「常識」の話なので記事にするまでもないことなのか、それともGnuplotユーザにはゼロ埋めしない月を軸の目盛りに書くニーズがないのか、あるいは自分のネット検索の方法が悪いのか、いずれにしても当時は日本語での関係記事を見つけることができず、数年間ほど放置していました。

ところが最近になって、あらためて英語ページも含めて探してみたら、ちゃんとありました<span style="color: red">!!!</span> 　参考にした記事は[こちら](https://stackoverflow.com/questions/62410451/single-digit-month-and-day-format-specifier-in-gnuplot-5-2)（など）です。

　ということで自分用の備忘としてここにメモしておきます。


## サンプルデータとコード {#サンプルデータとコード}

データはLedger-cliで算出した月ごとの水光熱費のサンプルデータです[^fn:2]。

```nil
2021-10-01 18257
2021-11-01 21196
2021-12-01 20420
2022-01-01 23295
2022-02-01 23741
2022-03-01 21057
2022-04-01 21540
2022-05-01 24144
2022-06-01 17953
2022-07-01 18296
2022-08-01 16668
2022-09-01 1055
```

図[1](#org48bc229)は次のようにして簡単に描けました（参考ページのおかげです） :smile:

```sh
#!/bin/gnuplot
set xdata time
set timefmt "%Y-%m-%d"
set format x "%01m" time
# date -d "2021/10/01" "+%s" ==> 1633014000最近になって、あらためて英語ページも含めて探してみた
set xrange [1633014000:]

plot './tmp-all-UC.csv' u 1:2 w linespoints
pause -1
```

ようするにミソは、Bashなら `%-m` とするところを<span style="color: red"> %01m</span>にするだけ[^fn:3]。

なお上の例では、
xrangeをセットしないと、なぜか一ヶ月前の `2021/09/01` からプロットされましたので、描出開始日をunixtime化しておいて `set xrange` してます。


## おまけ {#おまけ}


#### 日にちをゼロ埋めなしにする {#日にちをゼロ埋めなしにする}

フォーマットを <span style="color: red">%01d</span> にします。


#### Y軸への適用 {#y軸への適用}

****Y軸**** が月の場合にゼロ埋めなしで描く方法について、おもしろい記事がありました。
<https://stackoverflow.com/questions/65086109/how-to-plot-month-numbers-in-gnuplot-5-4>


#### ちなみに {#ちなみに}

図[2](#orgb7e4b70)は過去25ヶ月分のわが家の水光熱費のサンプルチャートです。
X軸の月の数字をゼロ埋め無しにしたおかげで、これまでよりもはるかに見やすくなりました。

<a id="orgb7e4b70"></a>

{{< figure src="/out-tmp_20220903.svg" width="90%" >}}


## Footnotes: {#footnotes}

[^fn:1]: 正しくは「左ゼロ埋め」とか「前ゼロ埋め」でしょうか。英語の **zero padding** をそのままカタカナにして「ゼロパディング」の言い方が多いようです。またゼロ埋めしないことは **zero suppress** （ゼロサプレス）ということもあるようですが、ここでは「ゼロ埋め」で統一しました。
[^fn:2]: クエリは `$ledger reg ^Expenses and 水光熱費 --amount-data --monthly --collapse --begin 2021/10/01 --current > ./tmp-all-UC.csv` 。
[^fn:3]: どうして `%01m` で「ゼロ埋め無し」になるのか、理屈はぜんぜんわかっていません:sweat:。
